<!--头部-->
{include file="common/head" title="$detail.title"/}
<!--弹窗-->
<link href="__ADMIN__/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">

<!-- Start of Page Container -->
<div class="page-container">
    <div class="container">
        <div class="row">
            <!-- start of page content -->
            <div class="span8 page-content">
                <article class=" type-post format-standard hentry clearfix">
                    <h1 class="post-title">{$detail.title}</h1>
                    <div class="post-meta clearfix">
                        <span class="date">时间：{$detail.create_time}</span>
                        <span class="author">上传：{$detail.name}</span>
                        <span class="category">浏览：{$detail.view_num}</span>
                        <span class="like-count">{$detail.down_num}</span>
                    </div><!-- end of post meta -->
                    <p>{$detail.content|raw}</p>
                </article>

                <span class="tags">
                    <strong>Tags:&nbsp;&nbsp;</strong>{$detail.classification.name}
                </span>
                <br><br>
                <p class="success" id="baidu">
                    <span>点击下载按钮，可获得资源的百度网盘链接！本课程需要 <strong>【{$detail.price}】 </strong> IT币。</span><br>
                    <span id="link" style="font-weight: 500;color: black"></span>
                </p>
                <div class="like-btn1" >
                    <span class="down1" onclick="down({$detail.id},{$detail.price})"> &nbsp;&nbsp;下载</span>
                </div>
                <br>


                <a hidden="hidden" href="{:url('login')}" target="_blank" id="tologin"></a>
                <a hidden="hidden" href="{:url('vip')}" target="_blank" id="tovip"></a>

                <hr/><br>
                <blockquote>
                    <h3>《第一编程网》—— 免责声明</h3>
                    <p> 1、本站教程等资源版权归原作者所有。<br>
                        2、本站所有资源来源于用户分享和网络搜集整理, 本站不承担任何技术及版权问题。<br>
                        3、如本帖内容侵害到您的版权，请立即通知我们, 本站将及时删除并致以最深的歉意。<br>
                        4、本站提供的各类视频教程等仅供研究学习，不得传播及用于其他用途，请在下载学习完后在24小时内删除。<br>
                        5、本站所有资源，用户都可以免费获取。<br>
                        6、若发现链接失效，请点击链接失效反馈，我们会尽快处理。<br>
                        7、如不同意以上声明，请勿下载，请勿使用，谢谢合作。<br>
                    </p>
                </blockquote>
                <hr/>
                <section>
                    <h3>最新下载用户</h3>
                    <ol class="commentlist1">
                        {volist name='download' id='item'}
                        <li class="comment even thread-even depth-1" >
                            <article>
                                <img src="__STORAGE__/{$item.user.head_img}" class="avatar avatar-60 photo" height="30" width="30">
                                <div class="comment-meta">
                                    <span style="line-height: 30px">
                                        <span style="font-weight: bold"> {$item.user.username} </span> -
                                        <img src="__INDEX__/images/vip{$item.user.vip_type}.png">

                                    </span>
                                    <span class="date" style="padding-left: 15px;padding-right: 20px">
                                            {$item.create_time}
                                    </span>
                                    {$item.comment}
                                </div><!-- end .comment-meta -->
                            </article><!-- end of comment -->
                        </li>
                        {/volist}
                    </ol>
                    <div style="color: black">. . . . . .</div>
                </section><!-- end of comments -->
                <hr/>
                <br>
                <section id="comments">
                    <h3 id="comments-title">留言内容</h3>

                    <ol class="commentlist">
                        <li class="comment even thread-even depth-1" >
                            <article>
                                <img src="__STORAGE__/img/20200323\cfb0fad1f6a568d4eda93ce3d986e80b.png" class="avatar avatar-60 photo" height="60" width="60">
                                <div class="comment-meta">
                                    <h5 class="author">
                                        <cite class="fn">
                                            <a href="#" rel="external nofollow" class="url">管理员</a>
                                        </cite>
                                        - <img src="__INDEX__/images/vip5.png">
                                    </h5>
                                    <p class="date">
                                        <a href="#">
                                            {$detail.create_time}
                                        </a>
                                    </p>
                                </div><!-- end .comment-meta -->
                                <div class="comment-body">
                                    资源已审核，可用！
                                </div><!-- end of comment-body -->
                            </article><!-- end of comment -->
                        </li>
                        {volist name='comment' id='item'}
                        <li class="comment even thread-even depth-1" >
                            <article>
                                <img src="__STORAGE__/{$item.user.head_img}" class="avatar avatar-60 photo" height="60" width="60">
                                <div class="comment-meta">
                                    <h5 class="author">
                                        <cite class="fn">
                                            <a href="#" rel="external nofollow" class="url">{$item.user.username}</a>
                                        </cite>
                                        - <img src="__INDEX__/images/vip{$item.user.vip_type}.png">
                                    </h5>
                                    <p class="date">
                                        <a href="#">
                                            {$item.create_time}
                                        </a>
                                    </p>
                                </div><!-- end .comment-meta -->
                                <div class="comment-body">
                                    {$item.content}
                                </div><!-- end of comment-body -->
                            </article><!-- end of comment -->
                        </li>
                        {/volist}
                    </ol>

                    <br>

                    <div id="respond">
                        <h3>留言：</h3>
                        <div>
                            <textarea class="span8" name="comment" id="comment" cols="58" rows="10" required="required"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="to_comment({$detail.id})">提交</button>
                    </div>

                </section><!-- end of comments -->

            </div>
            <!-- end of page content -->

            <!-- start of sidebar -->
            <aside class="span4 page-sidebar">
                <!--联系支持-->
                {include file="common/support" /}
                {include file="common/link" /}
                <!--课程分类标签-->
                {include file="common/tags" /}
            </aside>
            <!-- end of sidebar -->
        </div>
    </div>
</div>
<!-- End of Page Container -->

{include file="common/foot" /}

<script src="__H__/js/plugins/sweetalert/sweetalert.min.js"></script>
<script>
    //下载资源
    function down(c_id,p) {
        var user_name="{:session('user_name')}";
        var user_id="{:session('user_id')}";
        if (user_name.length >= 2 && user_name){
            $.ajax({
                async : false,    //表示请求是否异步处理
                type : "post",    //请求类型
                url : '{:url("down_course")}',//请求的 URL地址
                dataType : "json",//返回的数据类型
                data : {
                    'user_id' : user_id,
                    'user_name' : user_name,
                    'c_id' : c_id,
                    'price' : p
                },
                success: function (data) {
                    //console.log(data.code);  //在控制台打印服务器端返回的数据
                    if(data.code === 200){
                        $("#link").html(
                            "《"+data.data.title+"》<br>"+
                            data.data.baiduyun
                            + "<br>解压密码："
                            + data.data.rar_password
                            +"<br>请一定复制保存！刷新后则隐藏链接，可在【用户名】-【我的信息】中查看历史记录。");
                    }else{
                        swal({
                            title: "下载失败！",
                            text:  data.msg,
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#2E8B57",
                            confirmButtonText: "去充值",
                            closeOnConfirm: false
                        }, function () {
                            document.getElementById('tovip').click()
                        });
                        //swal("下载失败！", data.msg, "success");
                    }
                },
                error:function (data) {

                }
            });

        }else {
            swal({
                title: "欢迎来到《第一编程网》",
                text: "您还没有登录，请先登录呦~。",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#2E8B57",
                confirmButtonText: "去登录",
                closeOnConfirm: false
            }, function () {
                document.getElementById('tologin').click()
            });
        }

    }

    //评论
    function to_comment(c_id) {
        var user_name="{:session('user_name')}";
        var user_id="{:session('user_id')}";
        var comment = $("#comment").val();
        if (comment.length < 2 && comment){

            return false;
        }
        if (user_name.length >= 2 && user_name){
            $.ajax({
                async : false,    //表示请求是否异步处理
                type : "post",    //请求类型
                url : '{:url("comment")}',//请求的 URL地址
                dataType : "json",//返回的数据类型
                data : {
                    'user_id' : user_id,
                    'user_name' : user_name,
                    'comment' : comment,
                    'course_id' : c_id
                },
                success: function (data) {
                    //console.log(data.code);  //在控制台打印服务器端返回的数据
                    if(data.code === 200){
                        swal("留言成功！", " ", "success");
                        setTimeout(function(){
                            window.location.reload();
                        },1000);
                    }
                },
                error:function (data) {
                }
            });
        }else {
            swal({
                title: "欢迎来到《第一编程网》",
                text: "您还没有登录，请先登录呦~。",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#2E8B57",
                confirmButtonText: "去登录",
                closeOnConfirm: false
            }, function () {
                document.getElementById('tologin').click()
            });
        }

    }

</script>

